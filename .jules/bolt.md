## 2024-05-24 - [Avoid Mutating Dicts During CSV Field Mapping]
**Learning:** When writing CSV fields from JSON logs by iterating over an original to output field name mapping, avoid mutating the original `rec` dictionary `rec[output_name] = sanitize(rec.get(input_name, ""))`. If an output name generated from `input_name` collides with a subsequent `input_name` in the mapping list, we will mistakenly overwrite the value, leading to data loss (e.g. `'@a` overwriting `@a` if they were mapped to the same key or related sequences).
**Action:** Use dictionary comprehensions to build a separate row `row = {output_name: sanitize(rec.get(input_name, ""))}`. The overhead of creating a new dictionary per line is generally acceptable compared to the alternative safe mutation approach (which requires zipping arrays to pre-extract values), while still achieving performance gains by caching function lookups locally.
